import{a as _,Q as E,u as I,b as k,c as B,d as A}from"./use-quasar-Brha7Ip7.js";import{c as R,r as Q,D as $,E as j,o as D,g as z,h as N,b as O,F as U,G as F,e as G,p as H,H as J,I as K,s as L,v as M,x as T,y as x,J as W,A as p,B as g,Q as P}from"./index-ZUvgLMpK.js";const X=R({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(d,{slots:b,emit:m}){const n=z(),a=Q(null);let r=0;const l=[];function c(e){const f=typeof e=="boolean"?e:d.noErrorFocus!==!0,y=++r,w=(t,o)=>{m(`validation${t===!0?"Success":"Error"}`,o)},V=t=>{const o=t.validate();return typeof o.then=="function"?o.then(i=>({valid:i,comp:t}),i=>({valid:!1,comp:t,err:i})):Promise.resolve({valid:o,comp:t})};return(d.greedy===!0?Promise.all(l.map(V)).then(t=>t.filter(o=>o.valid!==!0)):l.reduce((t,o)=>t.then(()=>V(o).then(i=>{if(i.valid===!1)return Promise.reject(i)})),Promise.resolve()).catch(t=>[t])).then(t=>{if(t===void 0||t.length===0)return y===r&&w(!0),!0;if(y===r){const{comp:o,err:i}=t[0];if(i!==void 0&&console.error(i),w(!1,o),f===!0){const q=t.find(({comp:C})=>typeof C.focus=="function"&&U(C.$)===!1);q!==void 0&&q.comp.focus()}}return!1})}function u(){r++,l.forEach(e=>{typeof e.resetValidation=="function"&&e.resetValidation()})}function s(e){e!==void 0&&F(e);const f=r+1;c().then(y=>{f===r&&y===!0&&(d.onSubmit!==void 0?m("submit",e):e?.target!==void 0&&typeof e.target.submit=="function"&&e.target.submit())})}function h(e){e!==void 0&&F(e),m("reset"),G(()=>{u(),d.autofocus===!0&&d.noResetFocus!==!0&&v()})}function v(){_(()=>{if(a.value===null)return;(a.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||a.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||a.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(a.value.querySelectorAll("[tabindex]"),f=>f.tabIndex!==-1))?.focus({preventScroll:!0})})}H(J,{bindComponent(e){l.push(e)},unbindComponent(e){const f=l.indexOf(e);f!==-1&&l.splice(f,1)}});let S=!1;return $(()=>{S=!0}),j(()=>{S===!0&&d.autofocus===!0&&v()}),D(()=>{d.autofocus===!0&&v()}),Object.assign(n.proxy,{validate:c,resetValidation:u,submit:s,reset:h,focus:v,getValidationComponents:()=>l}),()=>N("form",{class:"q-form",ref:a,onSubmit:s,onReset:h},O(b.default))}}),Y={class:"q-pa-md",style:{"max-width":"600px"}},Z={class:"row justify-end"},ae=K({__name:"LoginPage",setup(d){const b=W(),m=I(),n=L({username:"",password:""}),a=Q(!1),r=()=>{n.username="",n.password=""},l=async()=>{a.value=!0;try{const c=await A.post("/auth/login",n);c.data?.token&&(localStorage.setItem("token",c.data.token),m.notify({type:"positive",message:"登入成功！",position:"top"})),b.push("/order")}catch(c){r(),m.notify({type:"negative",message:`登入失敗 ${c}`,position:"top"})}finally{a.value=!1}};return(c,u)=>(T(),M(E,{class:"flex flex-center"},{default:x(()=>[p(k,{class:"q-pa-lg shadow-5",style:{width:"400px","max-width":"90vw","border-radius":"16px"}},{default:x(()=>[u[2]||(u[2]=g("h1",{class:"text-h4 text-center text-bold"},"登入頁",-1)),g("div",Y,[p(X,{onSubmit:l,onReset:r,class:"q-gutter-md"},{default:x(()=>[p(B,{filled:"",modelValue:n.username,"onUpdate:modelValue":u[0]||(u[0]=s=>n.username=s),label:"帳號 *","lazy-rules":"",rules:[s=>!!s||"請輸入您的帳號"]},null,8,["modelValue","rules"]),p(B,{filled:"",modelValue:n.password,"onUpdate:modelValue":u[1]||(u[1]=s=>n.password=s),label:"密碼 *","lazy-rules":"",rules:[s=>!!s||"請輸入您的密碼"]},null,8,["modelValue","rules"]),g("div",Z,[p(P,{label:"重置",type:"reset",color:"primary",flat:"",class:"q-ml-sm"}),p(P,{label:"登入",type:"submit",color:"primary",loading:a.value},null,8,["loading"])])]),_:1})])]),_:1})]),_:1}))}});export{ae as default};
